suite: test kueueviz deployment
templates:
  - kueueviz/backend-deployment.yaml
  - kueueviz/frontend-deployment.yaml
  - kueueviz/backend-ingress.yaml
  - kueueviz/frontend-ingress.yaml
tests:
  - it: should set the pod priorityClassName when provided for backend deployment
    template: kueueviz/backend-deployment.yaml
    set:
      enableKueueViz: true
      kueueViz:
        priorityClassName: "foo"
    asserts:
      - equal:
          path: spec.template.spec.priorityClassName
          value: foo
  - it: should not render the pod priorityClassName if not set for backend deployment
    template: kueueviz/backend-deployment.yaml
    set:
      enableKueueViz: true
      priorityClassName:
    asserts:
      - notExists:
          path: spec.template.spec.priorityClassName
  - it: should set the pod priorityClassName when provided for frontend deployment 
    template: kueueviz/frontend-deployment.yaml
    set:
      enableKueueViz: true
      kueueViz:
        priorityClassName: "foo"
    asserts:
      - equal:
          path: spec.template.spec.priorityClassName
          value: foo
  - it: should not render the pod priorityClassName if not set for frontend deployment
    template: kueueviz/frontend-deployment.yaml
    set:
      enableKueueViz: true
      kueueViz:
        priorityClassName:       
    asserts:
      - notExists:
          path: spec.template.spec.priorityClassName
  - it: should  render the ingress value of backend ingress in frontend deployment as ENV variables
    template: kueueviz/frontend-deployment.yaml
    set:
      enableKueueViz: true
      kueueViz:
        backend:
          ingress:
            ingressClassName: "ingress-external"
            host: "backend.kueueviz.local"
            tlsSecretName: "kueueviz-frontend-tls"
    asserts:
      - equal:
          path: spec.template.spec.containers[0].env[0].value
          value: "wss://backend.kueueviz.local"
  - it: Render  Ingress for Backend Component
    template: kueueviz/backend-ingress.yaml
    set:
      enableKueueViz: true
      kueueViz:
        
        backend:
          ingress:
            ingressClassName: "ingress-internal"
            host: "backend.kueueviz.in"
            tlsSecretName: "kueueviz-backend-tls"
    asserts:
      - equal:
          path: spec.ingressClassName
          value: "ingress-internal"
      - equal:
          path: spec.rules[0].host
          value: "backend.kueueviz.in"
      - equal:
          path: spec.tls[0].secretName
          value: "kueueviz-backend-tls"

  - it: Render  Ingress for Frontend Component
    template: kueueviz/frontend-ingress.yaml
    set:
      enableKueueViz: true
      kueueViz:
        ingressClassName: "ingress-external"
        frontend:
          ingress:
            ingressClassName: "ingress-external"
            host: "frontend.kueueviz.in"
            tlsSecretName: "kueueviz-frontend-tls"
    asserts:
      - equal:
          path: spec.ingressClassName
          value: "ingress-external"
      - equal:
          path: spec.rules[0].host
          value: "frontend.kueueviz.in"
      - equal:
          path: spec.tls[0].secretName
          value: "kueueviz-frontend-tls"
  - it: should set the imagePullSecrets for backend deployment
    template: kueueviz/backend-deployment.yaml
    set:
      enableKueueViz: true
      kueueViz:
        imagePullSecrets:
          - name: "my-secret"
    asserts:
      - equal:
          path: spec.template.spec.imagePullSecrets[0].name
          value: "my-secret"
  - it: should set the imagePullSecrets for frontend deployment
    template: kueueviz/frontend-deployment.yaml
    set:
      enableKueueViz: true
      kueueViz:
        imagePullSecrets:
          - name: "my-secret"
    asserts:
      - equal:
          path: spec.template.spec.imagePullSecrets[0].name
          value: "my-secret"
